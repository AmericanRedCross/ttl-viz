<link rel="stylesheet" href="css/blueimp-gallery.min.css">
<style>

.gallery-thumb {
  cursor: pointer;
  margin: 12px;
  padding: 6px;
  height: 100px;
  width: 100px;
  border-radius: 2px;
  display: inline-block;
  box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);
}

.list-group{
  width: 100%;
  max-height: 420px;
  overflow-y: auto;
}

.list-group-item{
  width: 100%;
}

.article-list{
  width: 100%;
}

.fullscreen-modal .modal-dialog {
  margin: 0;
  margin-right: auto;
  margin-left: auto;
  width: 100%;
  height: 100%;
}

.modal-content{
  height:inherit;
}

.modal-body{
  height:90%;
  padding-left: 0px;
  padding-top: 0px;
  padding-right: 0px;
  padding-bottom: 0px;
}

.pdfobject-container { height: 100%;}

</style>

<!-- Modal -->
<div id="modal-container" class="modal fullscreen-modal fade" role="dialog" tabindex="-1" style="padding-right: 0px;">
  <div class="modal-dialog" >
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <!-- Content Layout Here -->
        <div id="pdf-viewer"></div>
        <script src="../js/pdfobject.js"></script>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="container">

<!-- <header class="row header">
	<div class="col-md-12">
		<h1>Gallery </h1>
	</div>
</header> -->

<hr>

<div class="row">
  <div class="col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
    <div id="blueimp-video-carousel" class="blueimp-gallery blueimp-gallery-controls blueimp-gallery-carousel">
        <div class="slides"></div>
        <h3 class="title"></h3>
        <a class="prev">‹</a>
        <a class="next">›</a>
        <a class="play-pause"></a>
    </div>
  </div>
</div>

<hr>

<div class="row">
    <div id="feature-article" class="col-md-8 col-sm-12 ">
      <div class="panel panel-default">
        <img class="img-responsive" src='https://img.youtube.com/vi/fPGx4IYrYiw/maxresdefault.jpg' />
      </div>
    </div>
    <div id="article-list" class="col-md-4 col-sm-12">
      <ul class="list-group">
        <button type="button" class="list-group-item list-group-item-action" onclick="getPreview('/story1.pdf')">Nilda's Second Choice</button>
        <button type="button" class="list-group-item list-group-item-action" onclick="getPreview('/story2.pdf')">Rosario's Garden</button>
        <button type="button" class="list-group-item list-group-item-action" onclick="getPreview('/story3.pdf')">Herminigilda's Red House</button>
        <button type="button" class="list-group-item list-group-item-action" onclick="getPreview('/story4.pdf')">Michell's New Job</button>
      </ul>
    </div>
</div>

<div id="gallery-links">
  <div class="text-center"><img src="img/loading.gif" alt="loading..."></div>
</div>

<!-- The Gallery as lightbox dialog, should be a child element of the document body -->
<div id="blueimp-gallery" class="blueimp-gallery">
    <div class="slides"></div>
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
</div>

<hr>
<footer id="site-footer">
	<div class="row row-logo">
				{{{logos}}}
			</div>
</footer>

</div> <!-- / container -->

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="js/blueimp-gallery.min.js"></script>
<script>

function getGalleryList(){
  $.ajax({
    type: 'POST',
    url: 'gallery'
  }).done(function(data){
    buildGallery(data);
  });
}


function buildGallery(data){
   var thumbs = [];
   var fulls = {};
   data.forEach(function(d){
    if(d.Key.indexOf("_THUMB") !== -1){
      thumbs.push(d.Key);
    } else {
      fulls[d.Key.slice(0, d.Key.lastIndexOf("."))] = d.Key;
    }
  });
  thumbs = thumbs.filter(function(d){
    return fulls[d.slice(0,d.indexOf("_THUMB"))] !== undefined;
  })

  $('#gallery-links').html('');

  var linksContainer = $('#gallery-links');
  var baseUrl = "http://arcttl.s3.amazonaws.com/";
  var galleryLinks = thumbs.map(function(d){ return baseUrl + fulls[d.slice(0,d.indexOf("_THUMB"))]; })

  var links = d3.select('#gallery-links').selectAll('div')
      .data(thumbs).enter()
      .append('div').attr('class', 'gallery-thumb')
      .attr('data-href', function(d){ return baseUrl + fulls[d.slice(0,d.indexOf("_THUMB"))]; })
      .on('click', function(d){
        blueimp.Gallery(galleryLinks, { index: galleryLinks.indexOf(d3.select(this).attr('data-href')) });
      })

    links.append('img').attr('src', function(d){
      return baseUrl + d;
    }).classed('img-responsive', true)

}

var videoId = ['ktn5xafEbis','kZBKLzAFRfs','4iVYAlvIq5U','Zu9tvqHip1E','rPF6M-vIcXM','4qp4z97HXHI','kv--VZhBw6E',
'fPGx4IYrYiw','GcK7xrA9TRk','B10I_iRzI84','S8ZUmpqT9pE','BDn1-MNb9mc','tAZulxGrbDs','5n2fZisRbqc','FpyqAir5LEU',
'G8J-1ll8fXA','hM_z3xWvR58','S6SaMu-FUkA','0Uk_OPBHtoU', '7rpeZv0_t_k','78hevWNhRm8','GfeX45lMM3A']

var videos = [];

for(var i=0;i<videoId.length;i++){
  videos[i] ={
    title: '',
    href: 'https://www.youtube.com/watch?v='+videoId[i],
    type: 'text/html',
    youtube: videoId[i],
    poster: 'https://img.youtube.com/vi/'+videoId[i]+'/maxresdefault.jpg'
  }
}

function getPreview(article){
  PDFObject.embed("../pdf"+article, "#pdf-viewer");
  $('#modal-container').modal('show');
}

blueimp.Gallery(videos, {
  container: '#blueimp-video-carousel',
  carousel: true
});

// http://arcttl.s3.amazonaws.com/gallery/CartoDB_NepalLogsRoutes.jpg

getGalleryList();

</script>
